
<html>
<head>
	<meta charset="UTF-8">
	<title>Canvas</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.2.0/socket.io.dev.js"></script>
    <!--pulls client side socket.io script from this url-->
</head>
<body>
    <canvas id='canvas' width="800" height="500" style='border: 1px solid; width: 800px; height: 600px;'>
        Sory, no browser for u.
    </canvas>
    <form action="../server/index.js" method="POST"  >
        <!--Add option where the user can upload their own image-->
        
        <fieldset>
           <legend>Submit Stats</legend>
           <table>
                <tr>
                    <td>
                       Lifes: 
                    </td>
                    <td>
                        <input type="number" name="lifes" min="1" max="13">
                    </td>
                </tr>
                <tr>
                    <td>
                        Muscle: 
                    </td>
                    <td>
                        <input type="number" name="muscle" min="1" max="13">
                    </td>
                </tr>
                <tr>
                    <td>
                        Blast: 
                    </td>
                    <td>
                        <input type="number" name="blast" min="1" max="13">
                    </td>
                </tr>
                <tr>
                    <td>
                        Guard: 
                    </td>
                    <td>
                        <input type="number" name="guard" min="1" max="13">
                    </td>
                </tr>
                <tr>
                    <td>
                        Fast: 
                    </td>
                    <td>
                        <input type="number" name="fast" min="1" max="13">
                    </td>
                </tr>
                <tr>
                    <td>
                        <input id="submit" onclick="submitBtn()" type="submit" value="Seal Your Vermin's Fate">
                    </td>
                    <td>
                        <input type="reset" value="Turn Back the Tides of Time and Begin Anew">
                    </td>
                </tr>
            </table> 
       </fieldset>   
    </form>
    
    

    <div id="mario-chat">
        <div id="chat-window">
            <div id="output"></div>
        </div>
        <input id="handle" type="text" placeholder="Handle"/>
        <input id="message" type="text" placeholder="Message"/>
        <button id="send">Send</button>
    </div>
    <!-- <script type="text/javascript" src="/client/js/verminCanvas.js"></script> -->
    <script>
        

        var md = false; 
        //INITIAL CANVAS SETUP
        var c = document.getElementById('canvas');
        c.addEventListener('mousedown', down);
        c.addEventListener('mouseup', toggledraw);
        //in this case, the event is the mouse moving
        c.addEventListener('mousemove', function(evt){
        var mousePos = getMousePos(c, evt); 
        //assigns returned variables from the getMousePos
        var posx = mousePos.x; 
        var posy = mousePos.y;
        draw(canvas, posx, posy); 
        }); 

        //sets the drawing surface width and height to 
        //whatever is set in the css
        c.width = c.scrollWidth;
        c.height = c.scrollHeight;

        //FUNCTIONS
        function down(){
        md = true; 
        }
        function toggledraw(){
        md = false; 
        }
        function getMousePos(c, evt){
        //returns the size of an element and its
        // position related to the viewport
        // in this case, the canvas
        var rect = c.getBoundingClientRect();
        return{
        x:evt.clientX - rect.left,
        y:evt.clientY - rect.top
        }
        }
        function draw(c, posx, posy){
        //get 2d drawing api
        var ctx = c.getContext('2d');
        if(md){
        //c.style.cursor="pointer"; 
        ctx.fillRect(posx, posy, 4, 4);
        }
        }

    </script>
    <script>

        //Make front end socket connection
        //io is available because we have access to it on the front end now
        var socket = io.connect('http://localhost:4000');
        socket.on('news', function (data) {
            console.log(data);
            socket.emit('my other event', { my: 'data' });
        });


        // Query DOM to be used in seperate file
        // var canvas = document.getElementById('canvas');
        // var handle = document.getElementById('handle');
        // var submitBtn = document.getElementById('submit');
        // var output = document.getElementById('output');
        function submitBtn(){
            app.post('server/index.js', (req, res) => {
                
            });  
            socket.emit('post', function(){
                alert(1); 
                const out = fs.createWriteStream('../img/test.png');
                const stream = canvas.createPNGStream(); 
                stream.pipe(out);
                out.on('finish', () => console.log('PNG created')); 
                const lifes = req.body.lifes; 
                res.end(); 

            });             
            
        }
    </script>
    <!-- <script type="text/javascript" src="/client/js/postVerminForm.js"></script> -->
</body>
</html>